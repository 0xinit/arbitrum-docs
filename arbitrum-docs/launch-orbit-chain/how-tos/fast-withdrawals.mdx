---
title: "Enable fast withdrawals on your Orbit chain"
sidebar_label: 'Enable fast withdrawals'
description: "Learn to deploy Fast Withdrawals"
author: coopermidroni, tucksondev
sme: tucksondev
user_story: As a current or prospective Orbit chain owner, I need to understand how to integrate with the Fast Withdrawal feature.
content_type: get-started
---

Optimistic rollups must sustain a multi-day challenge period to allow time for fraud proofs. This delays finality for users and apps, resulting in multi-day withdrawal times and cross-chain communication delays. 

Fast Withdrawals is a new configuration allowing Orbit chains to achieve fast finality. Orbit chains with Fast Withdrawals will have their transactions processed by a committee of validators. Transactions with a unanimous vote across the committee will have their state transition immediately confirmed.

This will allow:

- Orbit chains can configure a fast withdrawal frequency (any time up to 15 minutes)
- User withdrawals to are confirmed on the parent chain at frequencies up to ~15 minutes
- Enhanced cross-chain communication by allowing cross-chain apps to read finalized state up to the fast withdrawal frequency

## Recommended for AnyTrust

While any Orbit chain can adopt Fast Withdrawals, we only *recommend* Fast Withdrawals for AnyTrust chains. 

This is because AnyTrust chains, as an optimium, already have a minimum trust assumption placed in their Data Availability Committee (DAC) - which is for their nodes to provide data availability.

We recommend that Orbit chains built on AnyTrust set up their Fast Withdrawals Committee such that a

- The optimal set up for an AnyTrust chain is to have all DAC members *also* run validators as part of the Fast Withdrawals committee, which leverages the existing trust assumption on the DAC. **This means enabling Fast Withdrawals does not add any new trusted parties.**

An Orbit rollup is able to adopt Fast Withdrawals, however it would technically no longer be a rollup as the minimum trust assumption will shift to the trust placed in the Fast Confirmations committee.

## Adoption Instructions (Example Script)

To enable the Fast Withdrawals feature, there are 3 actions to take:

1. Make sure the chain is using nitro-contracts v2.1.0 or above
2. Activate the Fast Withdrawals feature
3. Upgrade the node software to nitro v3.1.1 or above

### Upgrading to nitro-contracts v2.1.0

As mentioned above, the Fast Withdrawals feature is available for chains that are using nitro-contracts v2.1.0 or above, specially the `RollupAdminLogic` and the `RollupUserLogic` contracts. You can check what nitro-contracts version your chain is using by running the [orbit versioner script](https://github.com/OffchainLabs/orbit-actions/blob/main/README.md#check-version-and-upgrade-path). 

If your chain is not running with nitro-contracts v2.1.0 or above, you’ll need to perform an upgrade to have enable this version. The [orbit versioner script](https://github.com/OffchainLabs/orbit-actions/blob/main/README.md#check-version-and-upgrade-path) will provide the upgrade paths needed to reach v2.1.0, but basically:

- If the chain is running nitro-contracs v1.1.x, you need to [upgrade first to v1.2.1](https://github.com/OffchainLabs/orbit-actions/blob/main/scripts/foundry/contract-upgrades/1.2.1/README.md).
- If the chain is running nitro-contracts v1.2.1, you need to [upgrade to v2.1.0](https://github.com/OffchainLabs/orbit-actions/blob/main/scripts/foundry/contract-upgrades/2.1.0/README.md).

Upgrading to the new nitro-contracts version, also requires updating the node software. For v2.1.0, validator nodes and the batch poster node should be running [nitro v3.1.1](https://github.com/OffchainLabs/nitro/releases/tag/v3.1.1-beta.2) or above.

If you’re upgrading your nitro-contracts from v1.2.1 to v2.1.0, and you’re using the standard wasm module root (without customizations), there are [action contracts available in the supported chains](https://github.com/OffchainLabs/orbit-actions/blob/main/scripts/foundry/contract-upgrades/2.1.0/README.md#deployed-instances). If you’re using a customized nitro software, with a different wasm module root, you can still deploy the action contract referencing your modified wasm module root (pre and post upgrade).

### Activating Fast Withdrawals

Once the chain is running nitro-contracts v2.1.0 or above, the new fast withdrawal parameters will be available in the `RollupAdminLogic` and the `RollupUserLogic` contracts.

Both the Orbit SDK and the Orbit actions repository provide configurable scripts to activate and configure fast withdrawals on an Anytrust chain. You can use either of those to activate the feature, both scripts perform the same actions.

<aside>
ℹ️ Even though there are 2 scripts available to activate Fast Withdrawals, you only need to execute one of them. Both scripts perform the same actions.

</aside>

**Orbit SDK script**

The Orbit SDK provides an [example script](https://github.com/OffchainLabs/arbitrum-orbit-sdk/tree/main/examples/setup-fast-withdrawal) to setup a fast withdrawal committee by performing the following operations:

1. Create a new n/n Safe wallet with the specified validators as signers
2. Add the specified validators to the Rollup validators whitelist
3. Set the new Safe wallet as the anytrustFastConfirmer in the Rollup contract
4. Set the new minimumAssertionPeriod if needed
5. Show how to configure the batch poster and validator nodes

To configure the script, you need to specify the following [environment variables](https://github.com/OffchainLabs/arbitrum-orbit-sdk/blob/main/examples/setup-fast-withdrawal/.env.example):

- CHAIN_OWNER_PRIVATE_KEY: private key of the account with executor privileges in the UpgradeExecutor admin contract for the chain. It will be the deployer of the multisig Safe wallet.
- PARENT_CHAIN_ID: chainId of the parent chain.
- ROLLUP_ADDRESS: address of the Rollup contract.
- FC_VALIDATORS: array of fast-withdrawal validators. They will be added as signers to the multisig Safe wallet, and will be added to the Rollup's validator whitelist. It is recommended that these are DAC members of the AnyTrust chain.
- MINIMUM_ASSERTION_PERIOD: optional parameter, that defaults to 75 blocks (~15 minutes). Minimum number of blocks that have to pass in between assertions (measured in L1 blocks).

Finally, follow these steps to execute the script (from the `examples/setup-fast-withdrawal` folder):

1. Install dependencies
    
    ```bash
    yarn install
    ```
    
2. Create .env file and add the env vars
    
    ```bash
    cp .env.example .env
    ```
    
3. Run the script
    
    ```bash
    yarn run dev
    ```
    

**Orbit actions script**

The Orbit actions repository also provides an [action script](https://github.com/OffchainLabs/orbit-actions/blob/main/scripts/foundry/fast-confirm/README.md) to activate fast withdrawals by performing the following operations:

1. Validate fast confirmation has not been enabled yet
2. Create a Safe contract for the fast confirmation committee
3. Set the Safe contract as the fast confirmer on the rollup
4. Set the Safe contract as a validator on the rollup
5. Set setMinimumAssertionPeriod to 1 block to allow more frequent assertion

To configure the action script, you need to specify the following [environment variables](https://github.com/OffchainLabs/orbit-actions/blob/main/scripts/foundry/fast-confirm/.env.example):

- UPGRADE_ACTION_ADDRESS: address of the upgrade action to execute. A standard version is deployed in all [supported chains](https://github.com/OffchainLabs/orbit-actions/blob/main/scripts/foundry/fast-confirm/README.md#deployed-instances). If you need to deploy your own action, execute the first step of [this process](https://github.com/OffchainLabs/orbit-actions/blob/main/scripts/foundry/fast-confirm/README.md#how-to-use-it).
- PARENT_UPGRADE_EXECUTOR_ADDRESS: private key of the account with executor privileges in the UpgradeExecutor admin contract on the parent chain. It will be the deployer of the multisig Safe wallet.
- PARENT_CHAIN_RPC: RPC endpoint of the parent chain.
- ROLLUP: address of the Rollup contract.
- FAST_CONFIRM_COMMITTEE: comma-separated list of fast-withdrawal validators. They must be whitelisted validators in the Rollup contract. They will be added as signers to the multisig Safe wallet. It is recommended that these are DAC members of the AnyTrust chain.

Finally, follow these steps to execute the script (from the `scripts/foundry/fast-confirm` folder):

1. Install dependencies
    
    ```bash
    yarn install
    ```
    
2. Create .env file and add the env vars
    
    ```bash
    cp .env.example .env
    ```
    
3. Execute the action. Upgrade can be executed using `cast` CLI command (part of Foundry installation), using the owner account (the one with executor rights on parent chain UpgradeExecutor) to send the transaction:

```bash
(export $(cat .env | xargs) && cast send $PARENT_UPGRADE_EXECUTOR_ADDRESS "execute(address, bytes)" $UPGRADE_ACTION_ADDRESS $(cast calldata "perform(address, address[])" $ROLLUP \[$FAST_CONFIRM_COMMITTEE\]) --rpc-url $PARENT_CHAIN_RPC --account EXECUTOR)
# use --account XXX / --private-key XXX / --interactive / --ledger to set the account to send the transaction from
```

**NOTE:** If you have a multisig as executor, you will can use the following command to create the payload for calling into the PARENT_UPGRADE_EXECUTOR:

```
(export $(cat .env | xargs) && cast calldata "execute(address, bytes)" $UPGRADE_ACTION_ADDRESS $(cast calldata "perform(address, address[])" $ROLLUP \[$FAST_CONFIRM_COMMITTEE\]))
```

### Configure Fast Withdrawal on nitro v3.1.1 or above

To be able to use Fast Withdrawal in your chain, the batch poster and the validators of the chain need to be running [nitro v3.1.1](https://github.com/OffchainLabs/nitro/releases/tag/v3.1.1-beta.2) or above.

The following parameters need to be configured in those nodes.

**Batch poster**

- `--node.batch-poster.max-delay=0h15m0s`
    - Since batches need to be posted so validators can create and confirm assertions, the maximum delay should be set to an amount close to the `minimumAssertionPeriod` defined in the rollup contract. Modify `0h15m0s` to the configured value.

**Validators**

- `--node.staker.enable-fast-confirmation=true`
    - Enables fast withdrawals in the validator node
- `--node.staker.fast-confirm-safe-address=<address of the Safe deployed>`
    - Configures the node to sign the transaction on the Safe wallet that acts as the fast confirmer
- `--node.staker.make-assertion-interval=0h15m0s`
    - Since assertions need to be created for them to be confirmed, the minimum interval to  create these assertions should be set to an amount close to the `minimumAssertionPeriod` defined in the rollup contract. Modify `0h15m0s` to the configured value.

## Assorted internal notes

<aside>
🚨 Note to self: 
- If a chain is already running with a contracts version before 2.1, you will need to use the upgrade action 

- If you are a new deployment and Rollup Creators for 2.1 and beyond, then you will need to use the example script

</aside>

### Preparation

Determine the desired Fast <a data-quicklook-from="confirmation">Confirmation</a> frequency

Determine a desired number of validators to sit on the Fast Confirmations committee

### Implementation

- A deployed Orbit chain using at least nitro-contracts v2.1
- **N** Validators operating at least Nitro version 3.x.x

An example script will guide you through:

1. Creating a n/n Safe wallet with specified validators as signers
2. Adding the specified validators to the Rollup validators whitelist
3. Set the new Safe wallet as the `anyTrustFastConfirmer` on the Rollup contract
4. Set the new `minimumAssertionPeriod` (if needed)
5. Configure the batch poster and validator nodes